(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{93:function(t,a,s){"use strict";s.r(a);var r=s(0),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"jpush-sdk-小米通道集成指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jpush-sdk-小米通道集成指南"}},[t._v("#")]),t._v(" JPush SDK 小米通道集成指南")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("在国内 Android 生态中，推送通道都是由终端与云端之间的长链接来维持，严重依赖于应用进程的存活状态。如今一些手机厂家会在自家 rom 中做系统级别的推送通道，再由系统分发给各个 app，以此提高在自家 rom 上的推送送达率。")]),t._v(" "),s("p",[t._v("JPush SDK 为了尽可能提高开发者在各类 rom 上的推送送达率，对使用 MIUI 的设备推送，自动切换到小米通道。同时，为了保证 SDK 的易用性，原本 JPush 的所有接口调用逻辑都不用修改,JPush 会对自身支持的功能做兼容.只需在manifest中配置上小米 SDK 必须的配置组件即可.")]),t._v(" "),s("h2",{attrs:{id:"功能描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能描述"}},[t._v("#")]),t._v(" 功能描述")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("JPush 初始化的时候可选择是否初始化 MiPush 通道。")])]),t._v(" "),s("li",[s("p",[t._v("在 MIUI 设备上 JPush 通道与 MiPush 通道共存.")])]),t._v(" "),s("li",[s("p",[t._v("MiPush 通道初始化后支持 stopPush/resumePush 与 tag/alias这些 JPush 原有的功能,其它的 JPush 未支持的功能目前暂时还不可用.")])])]),t._v(" "),s("p",[s("strong",[t._v("注1：极光集成小米通道在 JPush Android SDK 3.0.3 添加，对应测试的小米 SDK 版本为：3.2.2")])]),t._v(" "),s("p",[s("strong",[t._v("注2：极光 JPush Android SDK 3.6.0 升级小米通道SDK，对应测试的小米 SDK 版本为：3.7.5")])]),t._v(" "),s("h2",{attrs:{id:"手动配置集成步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动配置集成步骤"}},[t._v("#")]),t._v(" 手动配置集成步骤")]),t._v(" "),s("p",[t._v("主要步骤为：")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"#1"}},[t._v("1. 增加小米插件包及小米推送包")])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"#2"}},[t._v("2. 配置小米推送sdk所需要的权限")])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"#3"}},[t._v("3. 配置小米必须的组件")])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"#4"}},[t._v("4. 配置JPush接受的小米sdk的消息接受类")])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"#5"}},[t._v("5. 将XIAOMI_APPKEY与XIAOMI_APPID替换为在小米后台注册对应该应用的AppKey/AppID")])])])]),t._v(" "),s("h4",{attrs:{id:"_1-增加小米插件包及小米推送包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-增加小米插件包及小米推送包"}},[t._v("#")]),t._v(" "),s("h3",{attrs:{id:"1"}},[t._v("1. 增加小米插件包及小米推送包")])]),t._v(" "),s("ul",[s("li",[t._v("将third-push目录下找到xiaomi目录，从libs中拷贝其中的jar包至工程的libs目录下。")]),t._v(" "),s("li",[t._v("jar包说明：")]),t._v(" "),s("li",[t._v("jpush-android-plugin-xiaomi-v3.x.x.jar:插件包")]),t._v(" "),s("li",[t._v("MiPush_SDK_Client_x_x_x.jar:小米推送包")])]),t._v(" "),s("p",[s("strong",[t._v("注：")]),t._v(" 极光集成小米SDK在 JPush Android SDK 3.2.0 有升级，对应测试的小米 SDK 版本为：3.6.12\n"),s("strong",[t._v("注：")]),t._v(" 极光集成小米SDK在 JPush Android SDK 3.3.2 有升级，对应测试的小米 SDK 版本为：3.6.18\n"),s("strong",[t._v("注：")]),t._v(" 极光集成小米SDK在 JPush Android SDK 3.6.0 有升级，对应测试的小米 SDK 版本为：3.7.5")]),t._v(" "),s("h4",{attrs:{id:"_2-配置小米推送sdk所需要的权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置小米推送sdk所需要的权限"}},[t._v("#")]),t._v(" "),s("h3",{attrs:{id:"2"}},[t._v("2. 配置小米推送sdk所需要的权限")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v(" \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("permission\n   \t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"您应用的包名.permission.MIPUSH_RECEIVE"')]),t._v("\n    \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("protectionLevel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"signature"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n   \t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"您应用的包名.permission.MIPUSH_RECEIVE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n     \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.WRITE_EXTERNAL_STORAGE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.INTERNET"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.ACCESS_NETWORK_STATE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.ACCESS_WIFI_STATE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  \t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.READ_PHONE_STATE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.GET_TASKS"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.VIBRATE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n\n")])])]),s("h4",{attrs:{id:"_3-配置小米必须的组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置小米必须的组件"}},[t._v("#")]),t._v(" "),s("h3",{attrs:{id:"3"}},[t._v("3. 配置小米必须的组件")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service\n   \t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.push.service.XMJobService"')]),t._v("\n      \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n     \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("exported"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n     \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("permission"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.BIND_JOB_SERVICE"')]),t._v("\n     \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('":pushservice"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n  \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service\n     \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.push.service.XMPushService"')]),t._v("\n      \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n     \tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('":pushservice"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.mipush.sdk.PushMessageHandler"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("exported"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("service\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.mipush.sdk.MessageHandleService"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("receiver\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.push.service.receivers.NetworkStatusReceiver"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("exported"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.net.conn.CONNECTIVITY_CHANGE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("category android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.intent.category.DEFAULT"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("receiver"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("receiver\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.push.service.receivers.PingReceiver"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("exported"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('":pushservice"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.push.PING_TIMER"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("receiver"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\t另注：\n\t请不要将极光的组件 PushReceiver 配置进程和主进程分离。（按照示例默认配置即可）\n\t否则会影响小米 RegId 的获取。\n\n")])])]),s("h4",{attrs:{id:"_4-配置jpush接受的小米sdk的消息接受类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置jpush接受的小米sdk的消息接受类"}},[t._v("#")]),t._v(" "),s("h3",{attrs:{id:"4"}},[t._v("4. 配置JPush接受的小米sdk的消息接受类")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("receiver\n   \t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cn.jpush.android.service.PluginXiaomiPlatformsReceiver"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("exported"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.mipush.RECEIVE_MESSAGE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.mipush.MESSAGE_ARRIVED"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.xiaomi.mipush.ERROR"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("receiver"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),s("p",[s("em",[s("strong",[t._v("注")])]),t._v(" 对于同一个应用集成了多个推送SDK，且其他SDK也使用了小米通道的用户：\n可以将这个极光内置的Receiver，换成自己定义的Receiver。\n这个Receiver必须继承小米的com.xiaomi.mipush.sdk.PushMessageReceiver\n且在每个回调方法，都回调给极光的PluginXiaomiPlatformsReceiver。类似于这样：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMPushReceiver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PushMessageReceiver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PluginXiaomiPlatformsReceiver")]),t._v(" receiver "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PluginXiaomiPlatformsReceiver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReceivePassThroughMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiPushMessage")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReceivePassThroughMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNotificationMessageClicked")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiPushMessage")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNotificationMessageClicked")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNotificationMessageArrived")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiPushMessage")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onNotificationMessageArrived")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onCommandResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiPushCommandMessage")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onCommandResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReceiveRegisterResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiPushCommandMessage")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReceiveRegisterResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"_5-将小米应用的-appkey-和-appid-加上前缀“mi-”，填入meta-data-标签中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-将小米应用的-appkey-和-appid-加上前缀“mi-”，填入meta-data-标签中"}},[t._v("#")]),t._v(" "),s("h3",{attrs:{id:"5"}},[t._v("5. 将小米应用的 appkey 和 appid 加上前缀“MI-”，填入meta-data 标签中")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("data\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"XIAOMI_APPKEY"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MI-您的应用对应的小米的appkey"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("data\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"XIAOMI_APPID"')]),t._v("\n\t\tandroid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MI-您的应用对应小米的appID"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n\n")])])]),s("h2",{attrs:{id:"使用-jcenter-自动化集成步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-jcenter-自动化集成步骤"}},[t._v("#")]),t._v(" 使用 JCenter 自动化集成步骤")]),t._v(" "),s("ul",[s("li",[t._v("确认android studio的 Project 根目录的主 gradle 中配置了jcenter支持。（新建project默认配置就支持）")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("\tbuildscript "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\trepositories "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tallprojets "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\trepositories "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("ul",[s("li",[t._v("在应用 module 的 gradle 中 dependencies 节点添加如下代码:")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    dependencies "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        compile "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cn.jiguang.sdk.plugin:xiaomi:3.x.x'")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//版本号和对应的JPush版本号相同")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("ul",[s("li",[t._v("在应用 module 的 gradle 中 defaultConfig 节点添加如下代码:")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    manifestPlaceholders "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置manifest.xml中的变量")]),t._v("\n        XIAOMI_APPKEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MI-您的应用对应的小米的APPKEY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 小米平台注册的appkey")]),t._v("\n        XIAOMI_APPID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MI-您的应用对应的小米的APPID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 小米平台注册的appid")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n\n")])])]),s("ul",[s("li",[t._v("由于 MiPush 的 regid 只能在主进程获取,非主进程获取到的regid为空,所以极光的 PushReceiver应寄宿于应用主进程, 需要在AndroidManifest.xml中将 PushReceiver 的分离进程配置去掉。配置示例如下：")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("receiver\n      android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cn.jpush.android.service.PushReceiver"')]),t._v("\n      tools"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"replace"')]),t._v("\n      android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("priority"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1000"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cn.jpush.android.intent.NOTIFICATION_RECEIVED_PROXY"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Required")]),t._v("  显示通知栏 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("category android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${applicationId}"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.intent.action.USER_PRESENT"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.net.conn.CONNECTIVITY_CHANGE"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Optional")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.intent.action.PACKAGE_ADDED"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("action android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.intent.action.PACKAGE_REMOVED"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("data android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("scheme"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"package"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("intent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("receiver"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"mipush-sdk的编译混淆问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mipush-sdk的编译混淆问题"}},[t._v("#")]),t._v(" MiPush SDK的编译混淆问题")]),t._v(" "),s("p",[t._v("如果使用了 proguard，需要在配置文件中加入,可以防止一个误报的 warning 导致无法成功编译，")]),t._v(" "),s("pre",[s("code",[t._v("-dontwarn com.xiaomi.push.**\n-keep class com.xiaomi.push.** { *; }\n")])]),t._v(" "),s("h2",{attrs:{id:"点击通知跳转-activity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#点击通知跳转-activity"}},[t._v("#")]),t._v(" 点击通知跳转 Activity")]),t._v(" "),s("h3",{attrs:{id:"功能说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能说明"}},[t._v("#")]),t._v(" 功能说明")]),t._v(" "),s("h4",{attrs:{id:"支持的版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支持的版本"}},[t._v("#")]),t._v(" 支持的版本")]),t._v(" "),s("p",[t._v("此功能从 JPush Android SDK 3.3.8 开始支持")]),t._v(" "),s("h4",{attrs:{id:"通知跳转的定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通知跳转的定义"}},[t._v("#")]),t._v(" 通知跳转的定义")]),t._v(" "),s("p",[t._v("xiaomi push 允许开发者在推送通知的时候传入自定义的 intent uri 字符串，当用户点击了该通知，系统会根据 uri 的值过滤出匹配的 Activity ，并打开 Activity，达到跳转的目的。")]),t._v(" "),s("h3",{attrs:{id:"使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),s("h4",{attrs:{id:"push-api-推送说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#push-api-推送说明"}},[t._v("#")]),t._v(" Push API 推送说明")]),t._v(" "),s("p",[t._v('在 push api 的 payload 中的 "notification" 的 "android" 节点下添加以下字段：')]),t._v(" "),s("div",{staticClass:"table-d",attrs:{align:"center"}},[s("table",{attrs:{border:"1",width:"100%"}},[s("tr",{attrs:{bgcolor:"#D3D3D3"}},[s("th",[t._v("关键字")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("示例")]),t._v(" "),s("th",[t._v("说明")])]),t._v(" "),s("tr",[s("td",[t._v("uri_activity")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v('"com.example.jpushdemo.OpenClickActivity"')]),t._v(" "),s("td",[t._v("该字段用于指定开发者想要打开的 activity，值为activity 节点的 “android:name ” 属性值。")])])])]),t._v(" "),s("p",[s("em",[s("strong",[t._v("示例：")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('demo manifest配置：\n<activity android:name="com.example.jpushdemo.OpenClickActivity"\n      android:exported="true">\n      <intent-filter>\n           <action android:name="android.intent.action.VIEW"/>\n           <category android:name="android.intent.category.DEFAULT"/>\n      </intent-filter>\n</activity>\n\n请求json如下：\n{\n    "platform": [\n        "android"\n    ],\n    "audience": "all",\n    "notification": {\n        "android": {\n            "alert": "在线alert003",\n            "title": "在线title003",\n            "uri_activity": "com.example.jpushdemo.OpenClickActivity",\n        }\n    },\n    "message": {\n        "msg_content": "自定义消息内容003"\n    }\n}\n')])])]),s("p",[t._v("####SDK 端配置")]),t._v(" "),s("h5",{attrs:{id:"_1-androidmanifest-xml中配置点击通知要打开的-activity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-androidmanifest-xml中配置点击通知要打开的-activity"}},[t._v("#")]),t._v(" 1.AndroidManifest.xml中配置点击通知要打开的 activity")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('<activity android:name="您配置的activity"\n      android:exported="true">\n      <intent-filter>\n           <action android:name="android.intent.action.VIEW"/>\n           <category android:name="android.intent.category.DEFAULT"/>\n      </intent-filter>\n</activity>\n')])])]),s("p",[s("em",[s("strong",[t._v("注：")])]),t._v(" android:exported 属性必须设置为 true，并增加示例中的 intent-filter，否则会导致无法收到通知。")]),t._v(" "),s("h5",{attrs:{id:"_2-获取通知相关信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-获取通知相关信息"}},[t._v("#")]),t._v(" 2.获取通知相关信息")]),t._v(" "),s("p",[t._v("目前启动配置的 activity 都是使用 Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK 方式启动，只需要在您配置的 activity 中的onCreate方法中进行处理，获取通知信息。")]),t._v(" "),s("p",[t._v('通过 getIntent().getExtras().getString("JMessageExtra"); 获取到Intent 数据。获取到的数据是 JSON 字符串，通过解析可以获得通知相关内容。')]),t._v(" "),s("p",[t._v("JSON 示例如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('{\n\t"msg_id":"123456",\n\t"n_content":"this is content",\n\t"n_extras":{"key1":"value1","key2":"value2"},\n\t"n_title":"this is title",\n\t"rom_type":0\n}\n')])])]),s("p",[t._v("JSON 内容字段说明：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("取值类型")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("msg_id")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("通过此key获取到通知的msgid")])]),t._v(" "),s("tr",[s("td",[t._v("n_title")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("通过此key获取到通知标题")])]),t._v(" "),s("tr",[s("td",[t._v("n_content")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("通过此key获取到通知内容")])]),t._v(" "),s("tr",[s("td",[t._v("n_extras")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("通过此key获取到通知附加字段")])]),t._v(" "),s("tr",[s("td",[t._v("rom_type")]),t._v(" "),s("td",[t._v("byte")]),t._v(" "),s("td",[t._v("通过此key获取到下发通知的平台。得到值说明：byte类型的整数， 0为极光，1为小米，2为华为，3为魅族，4为oppo，5为vivo，8为FCM。")])])])]),t._v(" "),s("p",[s("em",[s("strong",[t._v("注：")])]),t._v(" rom_type 用于点击事件的上报，一般情况下开发者只需要取到该字段的值用于上报，不需要关心具体取值。")]),t._v(" "),s("h5",{attrs:{id:"_3-通知点击上报"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-通知点击上报"}},[t._v("#")]),t._v(" 3.通知点击上报")]),t._v(" "),s("p",[t._v("解析通知内容后，需主动调用接口来进行通知点击上报，上报接口如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/**\n* context 上下文\n* msgId 消息ID\n* whichPushSDK 收到推送的平台，即 rom_type 字段的取值。\n**/\nJPushInterface.reportNotificationOpened(Context context, String msgId, byte whichPushSDK);\n")])])]),s("p",[s("em",[s("strong",[t._v("注：")])]),t._v(" 点击上报必须传入正确的 whichPushSDK 参数，否则会造成统计数据错误。")]),t._v(" "),s("h5",{attrs:{id:"_4-activity-示例代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-activity-示例代码"}},[t._v("#")]),t._v(" 4.Activity 示例代码")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('package com.example.jpushdemo;\n\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.text.TextUtils;\nimport android.util.Log;\nimport android.widget.TextView;\n\nimport org.json.JSONException;\nimport org.json.JSONObject;\n\nimport cn.jpush.android.api.JPushInterface;\n\n/**\n * Created by jiguang on 17/7/5.\n */\n\npublic class OpenClickActivity extends Activity {\n    private static final String TAG = "OpenClickActivity";\n    /**消息Id**/\n    private static final String KEY_MSGID = "msg_id";\n    /**该通知的下发通道**/\n    private static final String KEY_WHICH_PUSH_SDK = "rom_type";\n    /**通知标题**/\n    private static final String KEY_TITLE = "n_title";\n    /**通知内容**/\n    private static final String KEY_CONTENT = "n_content";\n    /**通知附加字段**/\n    private static final String KEY_EXTRAS = "n_extras";\n    private TextView mTextView;\n\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mTextView = new TextView(this);\n        setContentView(mTextView);\n        handleOpenClick();\n    }\n\n\n    /**\n     * 处理点击事件，当前启动配置的Activity都是使用\n     * Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK\n     * 方式启动，只需要在onCreat中调用此方法进行处理\n     */\n    private void handleOpenClick() {\n        Log.d(TAG, "用户点击打开了通知");\n        String data = null;\n        //获取华为平台附带的jpush信息\n        if (getIntent().getData() != null) {\n             data = getIntent().getData().toString();\n        }\n\n        //获取fcm、oppo、vivo、华硕、小米平台附带的jpush信息\n        if(TextUtils.isEmpty(data) && getIntent().getExtras() != null){\n            data = getIntent().getExtras().getString("JMessageExtra");\n        }\n\n        Log.w(TAG, "msg content is " + String.valueOf(data));\n        if (TextUtils.isEmpty(data)) return;\n        try {\n            JSONObject jsonObject = new JSONObject(data);\n            String msgId = jsonObject.optString(KEY_MSGID);\n            byte whichPushSDK = (byte) jsonObject.optInt(KEY_WHICH_PUSH_SDK);\n            String title = jsonObject.optString(KEY_TITLE);\n            String content = jsonObject.optString(KEY_CONTENT);\n            String extras = jsonObject.optString(KEY_EXTRAS);\n            StringBuilder sb = new StringBuilder();\n            sb.append("msgId:");\n            sb.append(String.valueOf(msgId));\n            sb.append("\\n");\n            sb.append("title:");\n            sb.append(String.valueOf(title));\n            sb.append("\\n");\n            sb.append("content:");\n            sb.append(String.valueOf(content));\n            sb.append("\\n");\n            sb.append("extras:");\n            sb.append(String.valueOf(extras));\n            sb.append("\\n");\n            sb.append("platform:");\n            sb.append(getPushSDKName(whichPushSDK));\n            mTextView.setText(sb.toString());\n\n            //上报点击事件\n            JPushInterface.reportNotificationOpened(this, msgId, whichPushSDK);\n        } catch (JSONException e) {\n            Log.w(TAG, "parse notification error");\n        }\n\n\n    }\n\n    private String getPushSDKName(byte whichPushSDK) {\n        String name;\n        switch (whichPushSDK){\n            case 0:\n                name = "jpush";\n                break;\n            case 1:\n                name = "xiaomi";\n                break;\n            case 2:\n                name = "huawei";\n                break;\n            case 3:\n                name = "meizu";\n                break;\n            case 4:\n            \tname= "oppo";\n            \tbreak;\n            case 5:\n                name = "vivo";\n                break;\n            case 6:\n                name = "asus";\n                break;                    \n            case 8:\n                name = "fcm";\n                break;\n            default:\n                name = "jpush";\n        }\n        return name;\n    }\n}\n')])])])])}),[],!1,null,null,null);a.default=e.exports}}]);